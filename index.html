<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>bookmarklet: toggle display of bracketed text on a webpage (great for Amplified Bible)</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<style>
	body {
		margin: 0 auto;
		padding: 0 20px;
		max-width: 800px;
		font: 18px sans-serif;
	}

	textarea {
		box-sizing: border-box;
		width: 100%;
		height: 280px;
		margin: 0;
		resize: vertical;
		word-break: break-all;
	}

	#bookmarklet {
		cursor: move;
	}
	</style>
</head>
<body>
	<h1>Easy Bible passage preview on most any webpage</h1>
	<p>It can be a hassle having to look up verses one by one as you see them in an online article.</p>
	<p>I made a bookmarklet to make this easier. To use it, first drag this link to your bookmarks bar: <a href="#" id="bookmarklet">RefTagger</a>. Then, click the bookmark when you're on a webpage with un-linked Bible references. Each reference will then become a link that you can mouse-over to preview the scripture passage.</p>
	<p>The LORD be with you!<br>
	-<a href="https://github.com/Daniel-Hug/">Daniel Hug</a></p>

	<p>In case you need to copy and paste it, this is the URL for the bookmark:</p>
	<textarea id="src-preview"></textarea>

	<script src="node_modules/uglify-js/tmp/uglifyjs.js"></script>
	<script>
	(function() {
		// compress JS from JS panel via closure compiler API
		// and turn it into a "javascript:" link

		var compressor = UglifyJS.Compressor({
			negate_iife: false,
			unsafe: true,
			warnings: false
		});

		function uglify(js) {
			var ast = UglifyJS.parse(js);

			// compress
			ast.figure_out_scope();
			ast = ast.transform(compressor);

			// mangle
			ast.figure_out_scope();
			ast.mangle_names();

			// convert parse tree to string:
			return ast.print_to_string();
		}


		// grab elements
		var bookmarklet = document.getElementById('bookmarklet');
		var textarea = document.getElementById('src-preview');

		// get bookmarklet src with ajax
		var xhr = new XMLHttpRequest();
		xhr.open('GET', 'bookmarklet.js', true);

		// check for reply
		xhr.onreadystatechange = function() {
			if (xhr.readyState === 4) {
				handleSrc(xhr.responseText);
			}
		};

		// send request
		xhr.send();


		function handleSrc(bmScript) {
			// compress bookmarklet script
			var compressedJS = uglify(bmScript);

			// add script to link and textarea
			var href = "javascript:" + compressedJS.split('%').join('%25');
			bookmarklet.href = href;
			textarea.value = href;
		}
	})();
	</script>
</body>
</html>